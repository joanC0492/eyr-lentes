{% unless grid_item_width %}
  {% capture grid_item_width %}col-md-3 col-xs-6 col-sp-12{% endcapture %}
{% endunless %}
{% unless current_collection == blank %}
  {% assign current_collection = collection %}
{% endunless %}
{% assign on_sale = false %}
{% if product.compare_at_price > product.price %}
  {% assign on_sale = true %}
{% endif %}
{% assign sold_out = true %}
{% if product.available %}
  {% assign sold_out = false %}
{% endif %}
{% assign imagesize = settings.home_product_imagesize %}
{% assign imagesize1 = settings.product_count_down %}

{% assign new = false %}
{% assign new_count = settings.theme_newproduct | plus: 0 %}
{% assign date_published_year = product.published_at | date: '%Y' %}
{% assign date_published_month = product.published_at | date: '%m' %}
{% assign date_published_day = product.published_at | date: '%d' %}

{% assign date_now_year = 'now' | date: '%Y' %}
{% assign date_now_month = 'now' | date: '%m' %}
{% assign date_now_day = 'now' | date: '%d' %}

{% assign day_year = date_now_year | minus: date_published_year | times: 365 %}
{% assign day_month = date_now_month | minus: date_published_month | times: 30 %}
{% assign day_day = date_now_day | minus: date_published_day %}

{% assign date_difference = day_year | plus: day_month | plus: day_day %}
{% if date_difference <= new_count %}
  {% assign new = true %}
{% endif %}

{% assign productIndex = forloop.index | minus: 1 %}
{% if settings.productitem_animate_enable %}
  {% if settings.productitem_animate_delay != blank %}
    {% assign delayTime = settings.productitem_animate_delay | times: productIndex %}
  {% else %}
    {% assign delayTime = 100 | times: productIndex %}
  {% endif %}
  {% capture delayLoadProduct %}data-wow-delay="{{delayTime}}ms"{% endcapture %}
  {% assign effectLoadProduct = 'wow fadeIn' %}
{% else %}
  {% capture delayLoadProduct %}{% endcapture %}
  {% assign effectLoadProduct = '' %}
{% endif %}
{% if modcol == 1 and modpage == 1 or forloop.first %}
  {% assign item_special = 'item_special' %}
{% else %}
  {% assign item_special = '' %}
{% endif %}

<div
  class="product_block {{ effectLoadProduct }} {{ grid_item_width }} {{ item_special }}"
  {{ delayLoadProduct }}
  data-price="{{ product.price }}"
>
  <div class="product-container text-center product-block">
    <div class=" grid-view-item__title grid-view-item__title_product">
      <a class="product-name" href="{{ product.url | within: collection }}" title="{{ product.title | escape }}">
        {{- product.title | truncate: 40 -}}
      </a>
    </div>
    <div class="product-image-container image">
      <a class="product_img_link" href="{{ product.url | within: collection }}">
        {% if section.settings.count_down_product %}
          <img
            class=" img-product img-responsive "
            data-lazy="{{ product.featured_image | product_img_url: imagesize1 | split:'?' | first  }}"
            src="{{ product.featured_image | product_img_url: imagesize1  }}"
            alt="{{ product.featured_image.alt | escape }}"
          >
        {% elsif proLazyLoad and type_block != 'boostrap_carousel' %}
          <img
            class="img-product img-responsive "
            data-lazy="{{ product.featured_image | product_img_url: imagesize | split:'?' | first }}"
            src="{{ product.featured_image | product_img_url: imagesize| split:'?' | first  }}"
            alt="{{ product.featured_image.alt | escape }}"
          >
        {% else %}
          <img
            class="img-product img-responsive "
            data-lazy="{{ product.featured_image | product_img_url: imagesize | split:'?' | first  }}"
            src="{{ product.featured_image | product_img_url: imagesize  }}"
            alt="{{ product.featured_image.alt | escape }}"
          >
        {% endif %}
        {% if section.settings.count_down_product %}
        {% elsif settings.theme_more_pimages_option == 'showone' %}
          {% include 'product-more-image' %}
        {% endif %}
      </a>
      {% if settings.theme_more_pimages_option == 'showmore' %}
        {% include 'product-more-image' %}
      {% endif %}
      {% if new %}
        <span class="new-box">
          <span class="label-new label">{{ 'products.product.new_from_html' | t }}</span>
        </span>
      {% endif %}
      {% if on_sale %}
        <span class="sale-box">
          <span class="label-sale label">{{ 'products.product.on_sale_from_html' | t }}</span>
        </span>
      {% endif %}
      {% if dealTime %}
        <div class="dealTime_product">
          {% include 'block-productdeal' %}
        </div>
      {% endif %}

      {% if settings.theme_quickview_enable %}
        <div class="quickview">
          {% comment %} <a class="quick-view btn" href="#quick-view-product" data-id="{{ product.id }}" data-handle="{{ product.handle }}" title="{{ 'general.quickview.title' | t }}"></a> {% endcomment %}
          <a
            class="my-view btn"
            href="{{ product.url | within: collection }}"
            title="{{ 'general.quickview.title' | t }}"
          >
            <i class="fa fa-eye"></i>
            {% comment %}
              <span>{{ 'general.quickview.title' | t }}</span>
            {% endcomment %}
          </a>
        </div>
      {% endif %}
    </div>
    <div class="product-meta">
      {% if section.settings.count_down_product %}
        <div class="title_countdown grid-view-item__title">
          <a class="product-name" href="{{ product.url | within: collection }}" title="{{ product.title | escape }}">
            {{- product.title -}}
          </a>
        </div>
        {% include 'block-productdeal' %}
      {% endif %}
      {% if settings.ap_collection_product_description %}
        <div class="product-desc">
          {% if product.description contains '[/shortdesc]' %}
            {% assign shortdesc = product.description | split: '[shortdesc]' | last %}
            {{ shortdesc | split: '[/shortdesc]' | first }}
          {% else %}
            {{ product.description | strip_html | truncatewords: 20 }}
          {% endif %}
        </div>
      {% endif %}
      {% if settings.show_reviews_detail %}
        <div class="review">
          <span class="shopify-product-reviews-badge" data-id="{{ product.id }}"></span>
        </div>
      {% endif %}
      <div class="content_price">
        <span class="price product-price {% if on_sale %}sale-price{% endif %}">
          {{ product.price | money }}
        </span>
        {% if on_sale %}
          <span class="old-price product-price">{{ product.compare_at_price | money }}</span>
        {% endif %}
      </div>
      {% if settings.apollo_cart_collection_variants %}
        <div class="cart clearfix">
          {% assign variantCount = product.variants | size %}
          <div class="action">
            <form
              action="/cart/add"
              method="post"
              enctype="multipart/form-data"
              class="form-ajaxtocart form-vertical"
              data-pid="{{ product.id }}"
            >
              <div class="proVariants clearfix">
                <select
                  name="id"
                  data-id="{{ product.id }}"
                  data-handle="{{ product.handle }}"
                  class="product-single__variants"
                >
                  {% for variant in product.variants %}
                    {% if variant.available %}
                      <option
                        {% if variant == product.selected_or_first_available_variant %}
                          selected="selected"
                        {% endif %}
                        data-sku="{{ variant.sku }}"
                        value="{{ variant.id }}"
                      >
                        {{ variant.title }}
                      </option>
                    {% else %}
                      <option disabled="disabled">{{ variant.title }} - {{ 'products.product.sold_out' | t }}</option>
                    {% endif %}
                  {% endfor %}
                </select>
                {% if settings.ap_collection_swatch_item %}
                  {% unless count_item %}
                    {% assign count_item = 'count_item' %}
                  {% endunless %}
                  {% include 'swatch-item' with 'Color' %}
                {% endif %}
              </div>
              {% if settings.apollo_cart_collection_quantity %}
                <label class="quantity-selector">{{ 'products.product.quantity' | t }}</label>
                <input type="number" name="quantity" value="1" min="1" class="quantity-selector">
              {% endif %}
              <button type="submit" name="add" class="ajax_addtocart btn">
                <span class="AddToCartText">{{ 'products.product.add_to_cart' | t }}</span>
              </button>
            </form>
          </div>
        </div>
      {% else %}
        <div class="cart clearfix">
          {% assign variantCount = product.variants | size %}
          <div class="action">
            <form action="/cart/add" method="post" enctype="multipart/form-data" class="form-ajaxtocart">
              <input type="hidden" name="id" value="{{ product.variants.first.id }}">
              {% if sold_out %}
                <button class="button ajax_addtocart disabled" type="submit" value="Submit" disabled>
                  <span class="zmdi zmdi-shopping-cart-plus"></span>
                  <span>{{ 'products.product.sold_out' | t }}</span>
                </button>
              {% else %}
                {% if variantCount > 1 %}
                  <a
                    class="button ajax_addtocart"
                    href="{{ product.url | within: collection }}"
                    title="{{ product.title }}"
                  >
                    <span class="zmdi zmdi-shopping-cart-plus"></span>
                    <span class="select_options">{{ 'products.product.select_options' | t }}</span>
                  </a>
                {% else %}
                  <button class="button ajax_addtocart" type="submit" value="Submit">
                    <span class="zmdi zmdi-shopping-cart-plus"></span>
                    <span>{{ 'products.product.add_to_cart' | t }}</span>
                  </button>
                {% endif %}
              {% endif %}
            </form>
          </div>
        </div>
      {% endif %}
      <div class="product-item-actions">
        {% if settings.theme_compare_enable %}
          <div class="ap-cp-add-compare ap_cp_add ">
            <input
              type="checkbox"
              data-img="{{ product.featured_image.src | img_url: grid_image_width }}"
              data-title="{{product.title}}"
              data-id="{{ product.handle }}"
              class="ap-cp-add"
              title="Compare"
            >
            <i class="zmdi zmdi-refresh-alt"></i>
            <span>{{ 'general.compare.title' | t }}</span>
          </div>
        {% endif %}
        {% if settings.theme_wishlist_enable %}
          <div class="add-wishlist">
            {% include 'wishlist-product' %}
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>
